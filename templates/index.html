<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Conductor Agent Schedule</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <header>
      <div>
        <h1>ðŸš€ Daily Rhythm Conductor</h1>
        <p>Generate Chris's optimal schedule with health + cognition safeguards.</p>
      </div>
      <form action="/reset" method="post">
        <button type="submit" class="secondary">Reset to sample</button>
      </form>
    </header>

    <main>
      <section class="form-panel">
        <h2>Input signals</h2>
        <form action="/generate" method="post" class="grid">
          <div class="field">
            <label for="today_date">Date</label>
            <input
              id="today_date"
              name="today_date"
              type="date"
              value="{{ defaults.get('today_date', today_date) }}"
              required
            />
          </div>
          <div class="field">
            <label for="energy_level">Energy level</label>
            <select id="energy_level" name="energy_level">
              {% for option in ['unknown', 'low', 'medium', 'high'] %}
              <option
                value="{{ option }}"
                {% if defaults.get('energy_level') == option %}selected{% endif %}
              >
                {{ option|capitalize }}
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="field">
            <label for="mood">Mood</label>
            <select id="mood" name="mood">
              {% for option in ['neutral', 'stressed', 'creative', 'tired', 'excited'] %}
              <option
                value="{{ option }}"
                {% if defaults.get('mood') == option %}selected{% endif %}
              >
                {{ option|capitalize }}
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="field compact">
            <label for="hrv">HRV</label>
            <input
              id="hrv"
              name="hrv"
              type="number"
              min="0"
              placeholder="ms"
              value="{{ defaults.get('sleep_data', {}).get('HRV', '') }}"
            />
          </div>
          <div class="field compact">
            <label for="deep_sleep_hours">Deep sleep hours</label>
            <input
              id="deep_sleep_hours"
              name="deep_sleep_hours"
              type="number"
              step="0.1"
              min="0"
              value="{{ defaults.get('sleep_data', {}).get('deep_sleep_hours', '') }}"
            />
          </div>
          <div class="field compact">
            <label for="duration_hours">Sleep duration hours</label>
            <input
              id="duration_hours"
              name="duration_hours"
              type="number"
              step="0.1"
              min="0"
              value="{{ defaults.get('sleep_data', {}).get('duration_hours', '') }}"
            />
          </div>

          <div class="field">
            <label for="notion_version_goals">Version goals (3 max)</label>
            <textarea
              id="notion_version_goals"
              name="notion_version_goals"
              rows="3"
              placeholder="One per line"
            >{{ '\n'.join(defaults.get('notion_version_goals', [])) }}</textarea>
          </div>

          <div class="field">
            <label for="blockers">Blockers</label>
            <textarea
              id="blockers"
              name="blockers"
              rows="3"
              placeholder="Top 3 blocking items"
            >{{ '\n'.join(defaults.get('blockers', [])) }}</textarea>
          </div>

          <div class="field">
            <label for="linear_tasks">Linear tasks</label>
            <textarea
              id="linear_tasks"
              name="linear_tasks"
              rows="3"
              placeholder="Key tasks or tickets"
            >{{ '\n'.join(defaults.get('linear_tasks', [])) }}</textarea>
          </div>

          <div class="field">
            <label for="calendar_events">Calendar events</label>
            <textarea
              id="calendar_events"
              name="calendar_events"
              rows="3"
              placeholder="Include heavy meetings or reviews"
            >{{ '\n'.join(defaults.get('calendar_events', [])) }}</textarea>
          </div>

          <div class="field">
            <label for="slack_unreads">Slack unreads (filtered)</label>
            <textarea
              id="slack_unreads"
              name="slack_unreads"
              rows="2"
              placeholder="Only P0/P1 signals"
            >{{ '\n'.join(defaults.get('slack_unreads', [])) }}</textarea>
          </div>

          <div class="field">
            <label for="yesterday_expansion_log">Yesterday's expansion</label>
            <textarea
              id="yesterday_expansion_log"
              name="yesterday_expansion_log"
              rows="2"
              placeholder="Insights to close"
            >{{ '\n'.join(defaults.get('yesterday_expansion_log', [])) }}</textarea>
          </div>

          <div class="field checkbox">
            <label>
              <input
                type="checkbox"
                name="workout"
                {% if defaults.get('health_constraints', {}).get('workout') %}checked{% endif %}
              />
              Require workout
            </label>
          </div>
          <div class="field checkbox">
            <label>
              <input
                type="checkbox"
                name="deep_sleep_priority"
                {% if defaults.get('health_constraints', {}).get('deep_sleep_priority') %}checked{% endif %}
              />
              Prioritize deep sleep
            </label>
          </div>

          <div class="actions">
            <button type="submit">Generate schedule</button>
          </div>
        </form>
      </section>

      <section class="schedule-panel">
        <h2>Generated schedule</h2>
        {% if view %}
        <article class="schedule">
          <div class="block header">
            <h3>{{ view.header.title }}</h3>
            <p class="window">Date: {{ view.header.date }}</p>
            <ul>
              <li><strong>3 Version Goals:</strong> {{ view.header.version_goals|join(', ') }}</li>
              <li><strong>3 Blockers:</strong> {{ view.header.blockers|join(', ') }}</li>
              <li><strong>1 Meta Question:</strong> {{ view.header.meta_question }}</li>
            </ul>
          </div>
          {% for block in view.blocks %}
          <div class="block">
            <h3>{{ block.title }}</h3>
            <p class="window">{{ block.window }}</p>
            <ul>
              {% for item in block.actions %}
              <li>{{ item }}</li>
              {% endfor %}
            </ul>
          </div>
          {% endfor %}
        </article>
        <div class="copy-panel">
          <label for="schedule_text">Copy-paste schedule</label>
          <textarea id="schedule_text" readonly rows="12">{{ view.schedule_text }}</textarea>
        </div>
        {% else %}
        <p class="empty">Load sample data or add inputs to generate today's rhythm.</p>
        {% endif %}
      </section>
    </main>
  </body>
</html>
